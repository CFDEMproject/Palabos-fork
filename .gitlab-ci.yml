# This file is a template, and might need editing before it works on your project.
# use the official gcc image, based on debian
# can use verions as well, like gcc:5.2
    
cache:
    untracked: false
    key: "$CI_PROJECT_ID"
    
stages:
    - buildShowCases3d
    - buildShowCases2d
    - buildTutorials
    - buildCodesByTopic
    - buildStl

#test_pypal:
#    stage: build
#    
#    script: 
#        - apt-get update
#        - apt-get install -y swig python-dev
#        - export PALABOS_ROOT=`pwd`
#        - git clone git@gitlab.com:flowkit/pypal-web.git
#        - cd pypal-web/scripted-palabos/src
#        - export PYPAL_ROOT=`pwd`
#        - make
        
## Test compilation in the examples/showCases in 2d directory
showCases2d:
    stage: buildShowCases2d

    only:
        - master

    
    script: 
        - pwd
        - cd examples/showCases/womersley
        - make
        - cd ../poiseuille
        - make
        - cd ../carreauPoiseuille
        - make
        - cd ../boussinesqThermal2d
        - make
        - cd ../multiComponent2d
        - make
        - cd ../cavity2d
        - make
        - cd ../cylinder2d
        - make

## Test compilation in the examples/showCases in 2d directory
showCases3d:
    stage: buildShowCases3d

    only:
        - master
    
    script: 
        - pwd
        - cd examples/showCases/cavity3d/build
        - cmake ..
        - make
        - cd ..
        - cd ../rectangularChannel3d
        - make
        - cd ../boussinesqThermal3d
        - make
        - cd ../rectangularChannel3d
        - make
        - cd ../collidingBubbles3d
        - make
        - cd ../movingWall
        - make
        - cd ../multiComponent3d
        - make
        - cd ../externalFlowAroundObstacle
        - make
        - cd ../aneurysm
        - make
        - cd ../particlesInCone
        - make
        - cd ../heatedObjectInChannel
        - make
        - cd ../generalExternalFlow
        - make
        - cd ../vofMultiPhase
        - make

## Test compilation in the examples/tutorial directory
tutorial:
    stage: buildTutorials

    only:
        - master
    
    script: 
        - pwd
        - cd examples/tutorial/permeability
        - make
        - cd ../tutorial_1
        - make
        - cd ../tutorial_2
        - make

## Test compilation in the examples/codesByTopic directory
codesByTopic:
    stage: buildCodesByTopic

    only:
        - master
    
    script: 
        - pwd
        - cd examples/codesByTopic/coProcessor
        - make
        - cd ../transientStatistics
        - make
        - cd ../particlesInTube
        - make
        - cd ../marchingCube
        - make
        - cd ../complexNumbers
        - make
        - cd ../couplings
        - make
        - cd ../io
        - make
        - cd ../shanChenMultiPhase
        - make
        - cd ../copying
        - make
        - cd ../dynamicsInfo
        - make
        - cd ../navierStokesModels
        - make
        - cd ../bounceBack
        - make
        - cd ../dotList
        - make
        - cd ../externalMacroscopicVariables
        - make
        - cd ../asinariDynamics
        - make
        - cd ../scalarField
        - make
        - cd ../dataAnalysis
        - make
        - cd ../boundaryCondition
        - make
        - cd ../d3q13
        - make
        - cd ../linearAlgebra
        - make
        - cd ../userInput
        - make
        - cd ../multiBlock
        - make
        - cd ../smagorinskyModel
        - make
        - cd ../cutTriangularSurface
        - make
        - cd ../reparallelize
        - make
        
## Test compilation in the examples/showCases directory
stl:
    stage: buildStl

    only:
        - master
    
    script: 
        - pwd
        - cd utility/stl
        - sh buildAll.sh



# run tests using the binary built before
#test:
#  stage: test
#  script:
#    - ./runmytests.sh
